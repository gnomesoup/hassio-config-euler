group:
  lights_master_bedroom:
    name: "Lights Master Bedroom"
    entities:
      - light.bedroom_lamp
      - light.metal_lamp
      - light.ikea_of_sweden_tradfri_bulb_e26_ws_opal_1000lm_989e43fe_level_light_color_on_off

  lights_master_bedroom_and_closets:
    name: "Lights in Master Bedroom and Closets"
    entities:
      - light.bedroom_lamp
      - light.metal_lamp
      - light.ikea_of_sweden_tradfri_bulb_e26_ws_opal_1000lm_989e43fe_level_light_color_on_off
      - light.ikea_of_sweden_tradfri_bulb_e26_ws_opal_1000lm_62b607fe_level_light_color_on_off
      - light.ikea_of_sweden_tradfri_bulb_e26_ws_opal_1000lm_8c905bfe_level_light_color_on_off

automation:
  - alias: "Master Bedroom Lights on motion"
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.motion_master_bedroom
    condition:
      - condition: state
        entity_id: alarm_control_panel.home_alarm
        state: "disarmed"
      - condition: state
        entity_id: binary_sensor.sleepnumber_michael_angela_is_in_bed
        state: "off"
      - condition: state
        entity_id: binary_sensor.sleepnumber_michael_michael_is_in_bed
        state: "off"
      - condition: state
        entity_id: input_boolean.guest_mode
        state: "off"
      - condition: template
        value_template: >-
          {{ states("input_select.angela_status") != "Asleep" or
             states("input_select.michael_status") != "Asleep" }}
      - condition: template
        value_template: >-
          {{ states("input_select.angela_status") == "Home" or
             states("input_select.michael_status") == "Home" }}
      - condition: state
        entity_id: input_boolean.guest_mode
        state: "off"
    action:
      - service: homeassistant.turn_on
        data:
          entity_id:
            - group.lights_master_bedroom

  - alias: "Master Bedroom Button 1 Pushed"
    trigger:
      - platform: state
        entity_id: input_boolean.minimote_master_bedroom_1
    action:
      - service: homeassistant.toggle
        entity_id: light.bedroom_lamp


  - alias: "Master Bedroom Button 2 Pushed"
    trigger:
      - platform: state
        entity_id: input_boolean.minimote_master_bedroom_3
    action:
      - service: homeassistant.toggle
        entity_id: light.ikea_of_sweden_tradfri_bulb_e26_ws_opal_1000lm_989e43fe_level_light_color_on_off

  - alias: "Master Bedroom Button 2 Held"
    trigger:
      - platform: state
        entity_id: input_boolean.minimote_master_bedroom_4
    action:
      - service: homeassistant.toggle
        entity_id: group.lights_master_bedroom

  - alias: "Master Bedroom Button 3 Pushed"
    trigger:
      - platform: state
        entity_id: input_boolean.minimote_master_bedroom_5
    action:
      - service: homeassistant.toggle
        entity_id: light.metal_lamp

  # - alias: "Master Bedroom Button 4 Pushed"
  #   trigger:
  #     - platform: state
  #       entity_id: input_boolean.minimote_master_bedroom_7
  #   action:
  #     - service: homeassistant.toggle
  #       entity_id: light.aeon_labs_zw111_nano_dimmer_level

  # - alias: "Master Bedroom Lights On 1nd Switch"
  #   trigger:
  #     - platform: state
  #       entity_id:
  #         - switch.aeon_labs_zw111_nano_dimmer_switch
  #   condition:
  #     - condition: template
  #       value_template: >-
  #         {{ (states.switch.aeon_labs_zw111_nano_dimmer_switch.last_changed | as_timestamp) <
  #            (states.light.aeon_labs_zw111_nano_dimmer_level.last_changed | as_timestamp)}}
  #   action:
  #     - entity_id: light.bedroom_lamp
  #       service_template: >-
  #         {% if trigger.to_state.state == "on" %}
  #         homeassistant.turn_on
  #         {% else %}
  #         homeassistant.turn_off
  #         {% endif %}

  # - alias: "Master Bedroom Lights On 2nd Switch"
  #   trigger:
  #     - platform: state
  #       entity_id:
  #         - switch.aeon_labs_zw111_nano_dimmer_switch_2
  #   condition:
  #     - condition: template
  #       value_template: >-
  #         {{ (states.switch.aeon_labs_zw111_nano_dimmer_switch_2.last_changed | as_timestamp) <
  #            (states.light.aeon_labs_zw111_nano_dimmer_level_2.last_changed | as_timestamp)}}
  #   action:
  #     - entity_id: light.metal_lamp
  #       service_template: >-
  #         {% if trigger.to_state.state == "on" %}
  #         homeassistant.turn_on
  #         {% else %}
  #         homeassistant.turn_off
  #         {% endif %}

  - alias: "Laundry Door Open Turn On Light"
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.door_sensor_3
    action:
      - entity_id: light.ikea_of_sweden_tradfri_bulb_e26_ws_opal_1000lm_8c905bfe_level_light_color_on_off
        service_template: >-
          {% if trigger.to_state.state == "on" %}
          homeassistant.turn_on
          {% else %}
          homeassistant.turn_off
          {% endif %}

  - alias: "Master Closet Door Open Turn On Light"
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.door_sensor_1
    action:
      - entity_id: light.ikea_of_sweden_tradfri_bulb_e26_ws_opal_1000lm_62b607fe_level_light_color_on_off
        service_template: >-
          {% if trigger.to_state.state == "on" %}
          homeassistant.turn_on
          {% else %}
          homeassistant.turn_off
          {% endif %}

#   alias: "Master Bedroom Lights On At Night"
#   trigger:
#     - platform: state
#       entity_id:
#         - binary_sensor.sleepnumber_michael_angela_is_in_bed
#         - binary_sensor.sleepnumber_michael_michael_is_in_bed
#         - binary_sensor.motion_master_bedroom
#   condition:
#     - condition: state
